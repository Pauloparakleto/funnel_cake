var updateFunnelDiagram = function(opts) {
	$('funnel_diagram_spinner').appear({ duration: 0.5 });
	new Ajax.Request('diagram',
		{
			asynchronous:true,
			evalScripts:true,
			method:'get',
			parameters: {
				authenticity_token: '<%=escape_javascript(form_authenticity_token)%>',
				time_period: opts.time_period
			}
		}
	);
};

var canviz;
document.observe('dom:loaded', function() {
	canviz = new Canviz('funnel_diagram_container');
	canviz.setImagePath('/images/');
	canviz.setScale(0.45);
	canviz.parse('<%= escape_javascript(render("diagram.xdot.erb")) %>');
	$('funnel_diagram_spinner').style.position = 'absolute';
	$('funnel_diagram_spinner').style.top = $('funnel_diagram_container').positionedOffset().top+'px';
	$('funnel_diagram_spinner').style.left = $('funnel_diagram_container').positionedOffset().left+'px';
});
