digraph finite_state_machine {
	node [shape = box];
<% User.states_table.each do |s, state| -%>
	<% if state.primary? -%>
	<%=s%> [label = "<%= s.to_s.titleize + ": " + User.find_by_starting_state(s, {:date_range=>date_range}).count.to_s %>", style="setlinewidth(1.0)", color=blue, fontname=Helvetica];
	<% else -%>
	<%=s%> [label = "<%= s.to_s.titleize + ": " + User.find_by_starting_state(s, {:date_range=>date_range}).count.to_s %>", style="setlinewidth(0.75)", color=black, fontname=Helvetica];
	<% end -%>
<% end -%>

<% User.event_table.each do |ev_name, ev| -%>
	<% User.transition_table[ev_name].each do |trans| -%>
		<%=trans.from%> -> <%=trans.to%> [ label = "  <%= User.find_by_transition(trans.from, trans.to, {:date_range=>date_range}).count %>", style="setlinewidth(3.0)", color=saddlebrown, fontname=Helvetica ];
	<% end -%>
<% end -%>
}

